<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>次の連休までカウントダウン</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

body {
  background: #000;
  color: #0ff;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  font-family: 'Orbitron', 'Arial', sans-serif;
  padding: 0 20px;
  text-align: center;
  overflow: hidden;
  position: relative;
}

/* ===== タイマー表示 ===== */
.timer {
  display: flex;
  gap: 15px;
  font-size: 4rem;
  font-weight: 700;
  text-shadow: 0 0 8px #0ff, 0 0 16px #0ff, 0 0 32px #0ff;
  z-index: 2;
}

.digit {
  display: inline-block;
  min-width: 3rem;
  position: relative;
  overflow: hidden;
}

.digit.animate {
  animation: digitNoise 0.25s steps(2, start) infinite;
}

@keyframes digitNoise {
  0% { transform: translate(0,0); opacity:1; }
  25% { transform: translate(-1px, 1px); opacity:0.9; }
  50% { transform: translate(1px,-1px); opacity:1; }
  75% { transform: translate(-1px,-1px); opacity:0.95; }
  100% { transform: translate(0,0); opacity:1; }
}

.unit { display: flex; align-items: flex-end; }
.unit small { font-size: 1.2rem; margin-left: 4px; margin-bottom: 4px; }

.message {
  margin-top: 24px;
  font-size: 0.55rem;
  max-width: 600px;
  color: #0ff;
  text-shadow: 0 0 3px #0ff, 0 0 6px #0ff;
  line-height: 1.2;
  z-index: 2;
}

.celebration {
  display: none;
  font-family: 'Orbitron', 'Arial', sans-serif;
  font-size: 6rem;
  font-weight: 900;
  color: gold;
  text-shadow: 0 0 10px #fff, 0 0 20px gold, 0 0 40px gold, 0 0 80px gold;
  margin-top: 20px;
  position: relative;
  animation: glow 1.5s ease-in-out infinite alternate;
  z-index: 2;
}

@keyframes glow {
  0% { text-shadow: 0 0 10px #fff, 0 0 20px gold, 0 0 40px gold, 0 0 80px gold; }
  100% { text-shadow: 0 0 20px #fff, 0 0 40px gold, 0 0 80px gold, 0 0 160px gold; }
}

/* ===== 粒子 ===== */
.particle {
  position: absolute;
  pointer-events: none;
  border-radius: 50%;
  opacity: 0.9;
  transform: translate3d(0,0,0);
  animation-name: floatFall;
  animation-timing-function: linear;
}

@keyframes floatFall {
  0% { transform: translate3d(var(--x), 0, 0) rotate(0deg) scale(var(--scale)); opacity:1; }
  50% { transform: translate3d(calc(var(--x) + var(--drift)), 50vh, 180deg) scale(var(--scale)); opacity:0.8; }
  100% { transform: translate3d(calc(var(--x) + var(--drift)*1.5), 100vh, 360deg) scale(var(--scale)); opacity:0; }
}

/* ===== 背景ノイズ（ざらつき） ===== */
#grain {
  pointer-events: none;
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/></filter><rect width='100%' height='100%' filter='url(%23n)'/></svg>");
  background-size: cover;
  opacity: 0.05;
  animation: grainMove 0.4s steps(3) infinite;
  z-index: 1;
}

@keyframes grainMove {
  0%,100% { transform: translate(0,0); }
  25% { transform: translate(1px,-1px); }
  50% { transform: translate(-1px,1px); }
  75% { transform: translate(1px,1px); }
}

/* ===== スキャンライン ===== */
#scanlines {
  pointer-events: none;
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: repeating-linear-gradient(
    to bottom,
    rgba(0,255,255,0.05) 0px,
    rgba(0,255,255,0.05) 2px,
    transparent 2px,
    transparent 4px
  );
  animation: scan 4s linear infinite;
  z-index: 1;
}

@keyframes scan {
  0% { background-position: 0 0; }
  100% { background-position: 0 100%; }
}
</style>
</head>
<body>

<div class="timer" id="timer">
  <div class="unit"><span class="digit" id="days">0</span><small>日</small></div>
</div>

<div class="message" id="message">カウントダウンメッセージがここに表示されます。</div>
<div class="celebration" id="celebration">連休！</div>

<!-- 背景ノイズ & スキャンライン -->
<div id="grain"></div>
<div id="scanlines"></div>

<script>
const API_KEY = "AIzaSyCoOrWTtz2ZrjNOQwv_89XjtstKU3e2r-U";
const CALENDAR_ID = "ja.japanese#holiday@group.v.calendar.google.com";

const dayMessages = {
  1: "地球での1日は、火星では約24時間39分、木星では約9時間56分です。地球よりも火星、火星よりも木星の方が連休が早く訪れますよ。",
  2: "地球で2日を過ごしても、金星ではまだ1日の半分にも満たない時間です。ランチを食べ始める頃かもしれません。",
  3: "地球で3日を過ごすと、巨大ガス惑星の木星では約7.5日分、土星では約7.6日分に相当します。向こうではもう週明けみたいです。",
  4: "地球での4日は、天王星では約6.8日分です。天王星の1日は約17時間なので、向こうで過ごせば、1日に2回は朝を迎えられます。",
  5: "地球の5日は、海王星では約7.4日分です。海王星では、あっという間に1週間が過ぎてしまいそうですね。",
  6: "地球の6日は、冥王星ではまだ1日の半分以下です。冥王星の人は、朝のコーヒーを淹れている頃かもしれません。",
  7: "地球での7日を過ごしても、金星ではまだ朝ご飯の時間帯にすらなりません。",
  8: "地球で8日を過ごしても、水星ではまだ夜明け前です。水星の1日は地球の約176日分なので、連休までが遠いですね。",
  9: "地球で9日を過ごせば、木星では約21.8日分に相当し、3週間近くになります。",
  10: "地球での10日は、土星では約24日分に相当します。土星では、目を離すと連休が通り過ぎてしまいそうです。",
};

const daysEl = document.getElementById("days");
const messageEl = document.getElementById("message");
let prev = { days: null };

// 数字アニメーション
function animateDigit(el, value){
  el.classList.remove("animate");
  void el.offsetWidth;
  el.textContent = value;
  el.classList.add("animate");
}

// Googleカレンダー祝日取得
async function fetchHolidays() {
  try {
    const timeMin = new Date().toISOString();
    const endOfYear = new Date(new Date().getFullYear()+1, 11, 31).toISOString();
    const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(CALENDAR_ID)}/events?key=${API_KEY}&timeMin=${timeMin}&timeMax=${endOfYear}&singleEvents=true&orderBy=startTime`;
    const res = await fetch(url);
    const data = await res.json();
    if(!data.items) return [];
    return data.items.filter(ev => ev.start && ev.start.date).map(ev => new Date(ev.start.date));
  } catch(err) { console.error("祝日取得エラー:", err); return []; }
}

// 3日以上連休判定
function findNextLongHoliday(holidays){
  const date = new Date();
  for(let i=0;i<365;i++){
    let streak=[];
    let d = new Date(date);
    while(true){
      const isWeekend = d.getDay()===0 || d.getDay()===6;
      const isHoliday = holidays.some(h=>h.toDateString()===d.toDateString());
      if(isWeekend || isHoliday){ streak.push(new Date(d)); d.setDate(d.getDate()+1); }
      else { break;}
      if(streak.length>=3) return streak[0];
    }
    date.setDate(date.getDate()+1);
  }
  return null;
}

// 粒子生成
function createParticles() {
  const count = 40;
  for(let i=0;i<count;i++){
    const p = document.createElement('div');
    p.classList.add('particle');
    const size = Math.random()*10 + 5;
    p.style.width = `${size}px`;
    p.style.height = `${size}px`;
    p.style.background = Math.random()<0.7 ? `hsl(${Math.random()*360}, 80%, 60%)` : 'gold';
    p.style.setProperty('--x', `${Math.random()*window.innerWidth}px`);
    p.style.setProperty('--drift', `${(Math.random()-0.5)*100}px`);
    p.style.setProperty('--scale', `${Math.random()*0.8+0.5}`);
    p.style.animationDuration = `${Math.random()*3+3}s`;
    p.style.zIndex = Math.random() > 0.5 ? 0 : 1;
    document.body.appendChild(p);
    p.addEventListener('animationend', ()=>p.remove());
  }
}

// タイマー更新
function updateTimer(holidayDate){
  const now = new Date();
  let diffDays = Math.ceil((holidayDate - now) / (1000*60*60*24));

  const celebrationEl = document.getElementById('celebration');
  const timerEl = document.getElementById('timer');

  if(diffDays <= 0){
    timerEl.style.display = 'none';
    celebrationEl.style.display = 'block';
    messageEl.textContent = "連休が始まりました！楽しんでください。";

    createParticles();
    setInterval(createParticles, 400);
    return;
  }

  timerEl.style.display = 'flex';
  celebrationEl.style.display = 'none';

  if(diffDays !== prev.days) animateDigit(daysEl, diffDays);
  prev.days = diffDays;

  if(diffDays >= 1 && dayMessages[diffDays]) messageEl.textContent = dayMessages[diffDays];
  else messageEl.textContent = "もうすぐ連休です。準備はできていますか？";
}

// 初期化
(async function init(){
  const holidays = await fetchHolidays();
  const holidayDate = findNextLongHoliday(holidays);
  if(!holidayDate){
    messageEl.textContent="今後1年以内に3日以上の連休は見つかりませんでした。";
    return;
  }
  updateTimer(holidayDate);
  setInterval(()=>updateTimer(holidayDate), 1000);
})();
</script>
</body>
</html>

